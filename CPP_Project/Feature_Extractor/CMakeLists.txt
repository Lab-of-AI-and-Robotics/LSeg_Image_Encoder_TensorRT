cmake_minimum_required(VERSION 3.10)
project(trt_feature_extractor)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

find_package(CUDA REQUIRED)
find_package(OpenCV REQUIRED)
find_package(ZLIB REQUIRED) # ì¶”ê°€

# Include ë””ë ‰í† ë¦¬ ì„¤ì •
include_directories(
    ${CMAKE_SOURCE_DIR}/                    # ì´ CMakeLists.txt ìœ„ì¹˜
    ${CUDA_INCLUDE_DIRS}
    /usr/local/include/opencv4
    /usr/local/tensorrt/include
    ${CMAKE_SOURCE_DIR}/../third_party/cnpy   # ìƒìœ„ í´ë”ì˜ third_party ê²½ë¡œ
)

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ ì„¤ì •
link_directories(
    /usr/local/lib
    /usr/local/cuda/lib64
    /usr/local/tensorrt/lib
)

# cnpy ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
set(CNPY_PATH "${CMAKE_SOURCE_DIR}/../third_party/cnpy")
add_library(cnpy STATIC
    "${CNPY_PATH}/cnpy.cpp"
)

# ì‹¤í–‰ íŒŒì¼ ì„¤ì •
add_executable(trt_feature_extractor main.cpp)

# ë§í¬í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì •
target_link_libraries(trt_feature_extractor
    ${OpenCV_LIBS}
    ${CUDA_LIBRARIES}
    cudart
    nvinfer
    nvonnxparser
    cnpy
    ZLIB::ZLIB   # ğŸ”¥ libz ì¶”ê°€
)

set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O2 -g -fdiagnostics-color=always")
